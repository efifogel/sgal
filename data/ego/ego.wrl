#VRML V2.0 utf8
Configuration {
  accumulation Accumulation { enabled FALSE }
}
ColorBackground {
  color 0.5 0.5 0.5 0
  clearStencil TRUE
}
NavigationInfo { type [ "EXAMINE" "ANY" ] }
DEF TRANSFORMER_NAV NavigationInfo { type [ "TRANSFORM" ] }
DEF EGO_VIEW Viewpoint {
  # type "ORTHOGONAL"
  # fieldOfView 3.04
  radiusScale 0.7
}
DEF MODEL_VIEW Viewpoint {
  # type "ORTHOGONAL"
  # fieldOfView 2.0
  radiusScale 0.7
  position 0 0 8
}
DEF MODEL_VISIBLE_KEY SingleKeySensor { key "m" }
DEF INC_MODEL_VISIBLE Incrementor {
  minValue -1
  maxValue 0
  value 0
}
DEF EGO_VISIBLE_KEY SingleKeySensor { key "l" }
DEF INC_EGO_VISIBLE Incrementor {
  minValue -1
  maxValue 0
  value 0
}
DEF INC_EVEN_LAYER_X_KEY SingleKeySensor { key "q" }
DEF INC_EVEN_LAYER_X Incrementor {
  minValue 0
  maxValue 1
  value 0
}
DEF INC_EVEN_LAYER_Y_KEY SingleKeySensor { key "w" }
DEF INC_EVEN_LAYER_Y Incrementor {
  minValue 0
  maxValue 1
  value 0
}
DEF INC_ODD_LAYER_X_KEY SingleKeySensor { key "e" }
DEF INC_ODD_LAYER_X Incrementor {
  minValue 0
  maxValue 1
  value 1
}
DEF INC_ODD_LAYER_Y_KEY SingleKeySensor { key "r" }
DEF INC_ODD_LAYER_Y Incrementor {
  minValue 0
  maxValue 1
  value 1
}

DEF INC_OFFSET_BETWEEN_ROWS_KEY SingleKeySensor { key "a" }
DEF INC_OFFSET_BETWEEN_ROWS Incrementor {
  minValue 0
  maxValue 1
  value 0
}
DEF INC_TILING_ROW_KEY SingleKeySensor { key "s" }
DEF INC_TILING_ROW Incrementor {
  minValue 0
  maxValue 1
  value 1
}
DEF TRANSFORMER_NAV NavigationInfo { type [ "TRANSFORM" ] }
DEF EXPORT_KEY SingleKeySensor { key "O" }
DEF SNAP_KEY SingleKeySensor { key "S" }
DEF SNAP Snapshot {
  image Image { }
  fileFormat "jpg"
  sequence FALSE
  dirName "."
  fileName "ego_tetrahedron"
}

Transform {
  rotation 1 0 0 -1.5707
  #bboxCenter 0 0 0
  #bboxSize 1.5 1.5 1.5
  children [
    DEF SWITCH_MODEL Switch {
      whichChoice 0
      children [
	DEF MODEL Shape {
	  appearance Appearance {
	    material Material {}
	  }
	  geometry DEF MODEL_GEOM Polyhedron {
	    coord Coordinate {
	      point [0 0 1.732051,
		     1.632993 0 -0.5773503,
		     -0.8164966 1.414214 -0.5773503,
		     -0.8164966 -1.414214 -0.5773503,
		    ]
	    }
	    coordIndex [0,1,2,-1,
			0,2,3,-1,
			0,3,1,-1,
			1,3,2,-1,
		       ]
	  }
	}
       ]
    }
    DEF SWITCH_EGO Switch {
      whichChoice 0
      children [
	DEF EGO Ego {
	  appearance Appearance {
	    material Material {
	      diffuseColor 0.7 0.7 0.7
	      ambientIntensity 0.2
	      transparency 0
	    }
	    # texture ImageTexture { url ["negx.jpg"] }
	    texture CubeEnvironment {
	      rightImage Image {
		flip FALSE alpha TRUE transparency 0.2 url ["right.jpg"]
	      } 	# -90
	      leftImage Image { 
		flip FALSE alpha TRUE transparency 0.2 url ["left.jpg"]
	      }   	#  90
	      backImage Image { 
		flip FALSE alpha TRUE transparency 0.2 url ["back.jpg"]
	      }   	# 180
	      frontImage Image { 
		flip FALSE alpha TRUE transparency 0.2 url ["front.jpg"]
	      }
	      topImage Image { 
		flip FALSE alpha TRUE transparency 0.2 url ["top.jpg"]
	      }
	      bottomImage Image { 
		flip FALSE alpha TRUE transparency 0.2 url ["bottom.jpg"]
	      }		# 180
	    }
	  }
	  # style "appearance"
	  scale 100 100 100
	  model USE MODEL_GEOM
	  # spaceFilling TRUE
	  # layerXVisibility "notAbove"
	  # layerYVisibility "notAbove"
	  layerZVisibility "notAbove"
	  # spaceFilling TRUE
	  brickTypes [
	    2, 4, 1, 
	    4, 2, 1,
	    2, 2, 1,
	    2, 1, 1,
	    1, 2, 1,
	    1, 1, 1
          ]
          filler EgoVoxelsLayerFiller {
      	     offset -1
          } 
	  children [
	    DEF SELECT_EGO TouchSensor { enabled TRUE }
	   ]
	}
       ]
    }

    # The axes:
    Switch {
      whichChoice -1
      children [
	DEF AXES Transform {
	  # scale 0.1 0.1 0.1
	  children [
	    Shape {
	      appearance DEF AXES_APP Appearance {
		material Material {
		  # ambientIntensity 1
		  diffuseColor 0.4 0.4 0.4
		  # specularColor 0.3 0.3 0.3
		  # transparency 0.0001
		}
	      }
	      geometry Sphere { radius 0.1 }
	    }
	    DEF CS_AXIS Transform {
	      translation 0 1.5 0
	      children [
		Shape {
		  appearance USE AXES_APP
		  geometry Cylinder {
		    radius 0.1
		    height 3
		    set_is_bottom_visible FALSE
		    set_is_top_visible FALSE
		  }
		}
		Transform {
		  translation 0 1.7 0
		  children [
		    Shape {
		      appearance USE AXES_APP
		      geometry Cone {
			bottomRadius 0.2
			height 0.4
		      }
		    }
		   ]
		}
	       ]
	    }
	    Transform {
	      rotation 0 0 -1 1.57
	      children [ USE CS_AXIS ]
	    }
	    Transform {
	      rotation 1 0 0 1.57
	      children [ USE CS_AXIS ]
	    }
	   ]
	}
       ]
    }
   ]
}

# Model visible toggle
ROUTE MODEL_VISIBLE_KEY.state TO INC_MODEL_VISIBLE.trigger
ROUTE INC_MODEL_VISIBLE.value TO SWITCH_MODEL.whichChoice

# Ego visible toggle
ROUTE EGO_VISIBLE_KEY.state TO INC_EGO_VISIBLE.trigger
ROUTE INC_EGO_VISIBLE.value TO SWITCH_EGO.whichChoice

# Strategy
ROUTE INC_EVEN_LAYER_X_KEY.state TO INC_EVEN_LAYER_X.trigger
ROUTE INC_EVEN_LAYER_X.value TO EGO.evenLayerX

ROUTE INC_EVEN_LAYER_Y_KEY.state TO INC_EVEN_LAYER_Y.trigger
ROUTE INC_EVEN_LAYER_Y.value TO EGO.evenLayerY

ROUTE INC_ODD_LAYER_X_KEY.state TO INC_ODD_LAYER_X.trigger
ROUTE INC_ODD_LAYER_X.value TO EGO.oddLayerX

ROUTE INC_ODD_LAYER_Y_KEY.state TO INC_ODD_LAYER_Y.trigger
ROUTE INC_ODD_LAYER_Y.value TO EGO.oddLayerY

ROUTE INC_OFFSET_BETWEEN_ROWS_KEY.state TO INC_OFFSET_BETWEEN_ROWS.trigger
ROUTE INC_OFFSET_BETWEEN_ROWS.value TO EGO.offsetBetweenRows

ROUTE INC_TILING_ROW_KEY.state TO INC_TILING_ROW.trigger
ROUTE INC_TILING_ROW.value TO EGO.tilingRowsDirection

# Viewpoint
ROUTE MODEL_VISIBLE_KEY.state TO MODEL_VIEW.set_bind
ROUTE EGO_VISIBLE_KEY.state TO EGO_VIEW.set_bind

# Layer visibility
# ROUTE SELECT_EGO.activeSelectionId TO EGO.selectionId
ROUTE SELECT_EGO.overSelectionId TO EGO.selectionId

# Snapshot
ROUTE SNAP_KEY.state TO SNAP.trigger
